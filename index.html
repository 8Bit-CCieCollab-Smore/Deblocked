<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sign In</title>
<link rel="icon" href="/icon.png" type="image/png" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root {
    --bg-gradient-start: #4B5563;
    --bg-gradient-end: #1F2937;
  }

  /* Theme-specific overlay backgrounds and contrast text for overlay content */
  body.theme-default {
    --overlay-bg: rgba(255, 255, 255, 0.2);
    --overlay-text-color: #000;
  }
  body.theme-dark {
    --overlay-bg: rgba(255, 255, 255, 0.5);
    --overlay-text-color: #fff;
  }
  body.theme-classic {
    --overlay-bg: rgba(255, 255, 255, 0.1);
    --overlay-text-color: #000;
  }

  body {
    margin: 0;
    padding-left: 200px;
    box-sizing: border-box;
    transition: background 0.3s, color 0.3s;
    font-family: system-ui, sans-serif;
    background: linear-gradient(to right, var(--bg-gradient-start), var(--bg-gradient-end));
    background-repeat: no-repeat;
    background-size: 200% 100%;
    background-position: center;
    background-attachment: scroll; /* default, overridden in JS for fixed background */
    color: var(--text-color);
  }

  /* Dark Mode Styles */
  body.theme-dark {
    --bg-gradient-start: #000;
    --bg-gradient-end: #000;
    background: linear-gradient(to right, #000, #000);
  }

  /* Classic Mode Styles */
  body.theme-classic {
    --bg-gradient-start: #cdffd8;
    --bg-gradient-end: #94b9ff;
    background: linear-gradient(to right, #cdffd8 0%, #94b9ff 100%);
  }

  /* Frosted glass styles (common) */
  .header-frosted {
    background: rgba(120, 140, 172, 0.3);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow: 0 0 12px rgba(255,255,255,0.6);
    border: 1px solid rgba(255,255,255,0.3);
  }

  #particles-js {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
  }

  #sidebar {
    position: fixed;
    top: 0; left: 0;
    width: 200px;
    height: 100vh;
    background: rgba(120, 140, 172, 0.2);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow: 0 0 12px rgba(255,255,255,0.6);
    border-right: 1px solid rgba(255,255,255,0.3);
    z-index: 10;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #sidebar .logo {
    height: 3rem;
    max-width: 180px;
    margin-top: 20px;
  }
  #sidebar .logo-container {
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
    width: 100%;
  }
  #sidebar ul {
    width: 100%;
  }
  #sidebar li {
    width: 100%;
    text-align: center;
    margin-bottom: 0.75rem;
  }

  .glow {
    text-shadow: 0 0 8px #fff, 0 0 12px #fff, 0 0 16px #fff;
  }

  .content {
    position: relative;
    z-index: 20;
  }

  section {
    padding: 3rem 1rem;
  }
  .section-container {
    margin: 0 auto;
    max-width: 1000px;
  }

  .frosted-glass {
    background: rgba(120, 140, 172, 0.2);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow: 0 0 12px rgba(255,255,255,0.6);
    border: 1px solid rgba(255,255,255,0.3);
    width: 100%;
    max-width: 700px;
    margin: 0 auto;
    transition: transform 0.2s ease;
  }

  .header-frosted {
    background: rgba(120, 140, 172, 0.3);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow: 0 0 12px rgba(255,255,255,0.6);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 0.75rem;
  }

  .announcement-text {
    font-size: 1.75rem;
  }

  /* hide/show fullscreen buttons */
  .fullscreen-btn,
  .exit-fullscreen-btn {
    display: none;
  }

  /* Game overlay styles */
  .game-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .game-overlay-content {
    position: relative;
    width: 90%;
    height: 80%;
    display: flex;
    flex-direction: column;
  }
  .iframe-container {
    flex: 1;
    width: 100%;
    position: relative;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }
  .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #fff;
    color: #000;
    border: none;
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 4px;
    font-weight: bold;
    z-index: 10;
  }
  .fullscreen-btn,
  .exit-fullscreen-btn {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(255,255,255,0.8);
    border: none;
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 4px;
    font-weight: bold;
  }
  .exit-fullscreen-btn {
    display: none;
  }

  /* Game icons grid */
  #games-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(4, auto);
    gap: 20px;
    justify-items: center;
  }
  .game-icon {
    width: 100px;
    aspect-ratio: 1/1;
    border-radius: calc(100px * 0.225);
    overflow: hidden;
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
  }
  .game-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .icon-label {
    position: absolute;
    bottom: 100%;
    margin-bottom: 4px;
    width: 100%;
    text-align: center;
    font-weight: bold;
    font-size: 0.9rem;
    color: #fff;
    text-shadow: 0 0 2px #fff;
  }

  /* Forms grid styles */
  #forms-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    justify-items: center;
  }
  .form-card {
    width: 95%;
    aspect-ratio: 4/3;
    border-radius: calc(100px * 0.225);
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.3);
    box-shadow: 0 0 12px rgba(255,255,255,0.6);
    background: rgba(255,255,255,0.05);
    display: flex;
    flex-direction: column;
  }
  .form-iframe {
    flex: 1;
    width: 100%;
    border: none;
  }

  /* Section header images */
  .section-header-img {
    height: 8rem;
  }

  /* Frosted background for sidebar links */
  .bg-frosted {
    background: rgba(120, 140, 172, 0.3);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Cogwheel icon glow and position */
  .cog-icon {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 40px;
    height: 40px;
    cursor: pointer;
    fill: #fff;
    transition: fill 0.2s;
    filter: drop-shadow(0 0 4px #fff);
  }
  .cog-icon:hover {
    fill: #ccc;
  }

  /* Theme toggle buttons */
  .theme-toggle-group {
    display: flex;
    justify-content: space-around;
    margin-top: 1rem;
  }
  .theme-button {
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    border: 1px solid #fff;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9rem;
    transition: background 0.2s;
  }
  .theme-button:hover {
    background: rgba(255,255,255,0.2);
  }
  .theme-button.active {
    background: #fff;
    color: #000;
  }

  /* Back button inside overlay */
  .back-button {
    position: absolute;
    bottom: 10px;
    right: 15px;
    background: rgba(255,255,255,0.2);
    color: #fff;
    border: none;
    padding: 0.3rem 0.8rem;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 8px rgba(255,255,255,0.5);
    font-size: 0.8rem;
  }
  .back-button:hover {
    background: rgba(255,255,255,0.3);
    box-shadow: 0 0 12px rgba(255,255,255,0.8);
  }

  /* Settings overlay styles with larger height & custom background support */
  .settings-overlay {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%;
    max-width: 500px;
    max-height: 90%;
    background: var(--overlay-bg);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-radius: 10px;
    display: none; /* hidden by default, shown with 'show' class */
    flex-direction: column;
    padding: 1rem;
    z-index: 9999;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    overflow: hidden;
    color: var(--overlay-text-color);
  }
  .settings-overlay.show {
    display: flex;
  }
</style>
</head>
<body>

<!-- Particles -->
<div id="particles-js"></div>

<!-- Sidebar -->
<nav id="sidebar" class="flex flex-col items-center">
  <!-- Logo at top -->
  <div class="logo-container">
    <a href="#home" style="margin-top:20px;">
      <img src="https://ik.imagekit.io/yyjyznrctj/Cool%20Text%20-%20Deblocked%20483201143155958.png" alt="Deblocked Logo" class="logo" style="height:3rem; max-width:180px;"/>
    </a>
  </div>
  <!-- Navigation links -->
  <ul class="flex flex-col space-y-2 w-full px-2">
    <li><a href="#home" class="block py-2 font-bold glow text-white hover:no-underline bg-frosted px-2 py-1 rounded">Home</a></li>
    <li><a href="#games" class="block py-2 font-bold glow text-white hover:no-underline bg-frosted px-2 py-1 rounded">Games</a></li>
    <li><a href="#game-links" class="block py-2 font-bold glow text-white hover:no-underline bg-frosted px-2 py-1 rounded">Game Links</a></li>
    <li><a href="#proxies" class="block py-2 font-bold glow text-white hover:no-underline bg-frosted px-2 py-1 rounded">Proxies</a></li>
    <li><a href="#hacks" class="block py-2 font-bold glow text-white hover:no-underline bg-frosted px-2 py-1 rounded">Hacks</a></li>
    <li><a href="#forms" class="block py-2 font-bold glow text-white hover:no-underline bg-frosted px-2 py-1 rounded">Forms</a></li>
  </ul>
  <!-- Settings cogwheel -->
  <svg id="settings-icon" class="cog-icon cursor-pointer" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-label="Settings" role="button" tabindex="0" title="Settings" style="filter:drop-shadow(0 0 4px #fff);">
    <path fill="currentColor" d="M19.43 12.98c.04-.32.07-.65.07-.98s-.03-.66-.07-.98l2.11-1.65a.5.5 0 00.12-.66l-2-3.46a.5.5 0 00-.61-.21l-2.49 1a6.98 6.98 0 00-1.71-.98l-.38-2.65A.5.5 0 0014 2h-4a.5.5 0 00-.5.43l-.38 2.65c-.63.23-1.21.52-1.71.98l-2.49-1a.5.5 0 00-.61.21l-2 3.46a.5.5 0 00.12.66l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65a.5.5 0 00-.12.66l2 3.46c.15.26.43.34.66.21l2.49-1c.5.46 1.08.75 1.71.98l.38 2.65c.05.33.33.57.66.43h4c.33.14.61-.1.66-.43l.38-2.65c.63-.23 1.21-.52 1.71-.98l2.49 1c.23.13.51.05.66-.21l2-3.46a.5.5 0 00-.12-.66z"/>
  </svg>
</nav>

<!-- Main Content -->
<div class="content">

<!-- Announcements -->
<section id="home">
  <div class="section-container">
    <div class="frosted-glass rounded-xl p-6 mx-auto shadow-lg max-w-3xl">
      <h1 class="text-3xl font-bold mb-4 text-center text-white glow announcement-text">Announcements</h1>
      <p class="text-lg text-center text-white">whats up 🖐️</p>
    </div>
  </div>
</section>

<!-- FORMS -->
<section id="forms">
  <div class="section-container">
    <div class="header-frosted p-2 mb-4 flex flex-col items-center justify-center rounded-lg mx-auto max-w-3xl">
      <img src="https://ik.imagekit.io/yyjyznrctj/Cool%20Text%20-%20Forms%20490421769719423.png" class="section-header-img" alt="Forms" />
      <!-- Space for custom text -->
      <div style="margin-top:10px; text-align:center; font-size:1rem; color:#fff;">Let me know in the Chat if you want to Promote your Hustle here</div>
    </div>
    <div id="forms-grid"></div>
  </div>
</section>

<!-- GAMES -->
<section id="games">
  <div class="section-container">
    <div class="header-frosted p-2 mb-4 flex items-center justify-center rounded-lg mx-auto max-w-3xl">
      <img src="https://ik.imagekit.io/yyjyznrctj/Cool%20Text%20-%20Games%20483200995420439.png?updatedAt=1748118733460" class="section-header-img" alt="Games" />
    </div>
    <div id="games-grid"></div>
  </div>
</section>

<!-- Game Links -->
<section id="game-links">
  <div class="section-container">
    <div class="header-frosted p-2 mb-4 flex items-center justify-center rounded-lg mx-auto max-w-3xl">
      <img src="https://ik.imagekit.io/yyjyznrctj/Cool%20Text%20-%20Game%20Links%20483201030081785.png" class="section-header-img" alt="Game Links" />
    </div>
    <div id="game-links-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
  </div>
</section>

<!-- PROXIES -->
<section id="proxies">
  <div class="section-container">
    <div class="header-frosted p-2 mb-4 flex items-center justify-center rounded-lg mx-auto max-w-3xl">
      <img src="https://ik.imagekit.io/yyjyznrctj/Cool%20Text%20-%20Proxies%20483201036052784.png" class="section-header-img" alt="Proxies" />
    </div>
    <div class="max-w-3xl mx-auto mb-4">
      <!-- Proxy content here -->
    </div>
  </div>
</section>

<!-- HACKS -->
<section id="hacks">
  <div class="section-container">
    <div class="header-frosted p-2 mb-4 flex items-center justify-center rounded-lg mx-auto max-w-3xl">
      <img src="https://ik.imagekit.io/yyjyznrctj/Cool%20Text%20-%20Hacks%20483206932003080.png" class="section-header-img" alt="Hacks" />
    </div>
    <div class="max-w-3xl mx-auto mb-4">
      <!-- Hacks content here -->
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="bg-gradient-to-r py-4">
  <div class="mx-auto max-w-5xl text-center">
    <p>© <script>document.write(new Date().getFullYear())</script> @Smoreh All rights reserved.</p>
  </div>
</footer>

</div> <!-- end content -->

<!-- overlay for games -->
<div class="game-overlay"></div>

<!-- Settings modal with larger height & custom background support -->
<div class="settings-overlay" id="settingsOverlay">
  <!-- Header Image -->
  <div class="settings-header" style="display:flex; justify-content:center; align-items:center;">
    <img src="https://ik.imagekit.io/yyjyznrctj/Cool%20Text%20-%20Settings%20490740257480553.png" alt="Settings" style="max-width:100%; height:auto;">
  </div>
  
  <!-- Mode/Theme toggles and Custom Background Button -->
  <div style="margin-top:1rem; display:flex; flex-direction:column; align-items:center; gap:0.75rem;">
    <div class="theme-toggle-group" style="display:flex; gap:0.5rem;">
      <button class="theme-button active" data-theme="default" onclick="setTheme('default')">Default</button>
      <button class="theme-button" data-theme="dark" onclick="setTheme('dark')">Dark Mode</button>
      <button class="theme-button" data-theme="classic" onclick="setTheme('classic')">Classic</button>
    </div>
    <button class="theme-button" onclick="toggleCustomBg()">Custom Background</button>
  </div>
  
  <!-- Custom Background Upload & URL input -->
  <div id="customBgContainer" style="display:none; margin-top:1rem; width:100%; text-align:center;">
    <input type="file" id="backgroundUpload" accept="image/*" style="display:none" onchange="applyUploadedBackground()">
    <button style="margin-top:0.5rem; padding:0.5rem 1rem; border-radius:4px; border:none; background:#4cd964; color:#fff; cursor:pointer;" onclick="document.getElementById('backgroundUpload').click()">Upload Image</button>
    <button style="margin-top:0.5rem; margin-left:0.5rem; padding:0.5rem 1rem; border-radius:4px; border:none; background:#ccc; color:#000; cursor:pointer;" onclick="removeCustomBackground()">Remove</button>
  </div>
  <!-- Optional: Input for URL -->
  <div id="customUrlBgContainer" style="display:none; margin-top:1rem; width:100%; text-align:center;">
    <input type="text" id="bgImageUrl" placeholder="Enter image URL" style="width:80%; padding:0.5rem; border-radius:4px; border:1px solid #ccc;">
    <button style="margin-left:0.5rem; padding:0.5rem 1rem; border-radius:4px; border:none; background:#4cd964; color:#fff; cursor:pointer;" onclick="applyCustomBackgroundUrl()">Set Background</button>
    <button style="margin-left:0.5rem; padding:0.5rem 1rem; border-radius:4px; border:none; background:#ccc; color:#000; cursor:pointer;" onclick="removeCustomBackground()">Remove</button>
  </div>
  
  <!-- Back Button -->
  <button class="back-button" onclick="closeSettings()">Back</button>
</div>

<!-- Scripts -->
<script src="https://deadsimplechat.com/js/embed.js" type="text/javascript"></script>
<script>
  // Initialize chat
  window.DeadSimpleChat.initBubble({
    location: "https://deadsimplechat.com",
    size: "small",
    roomId: "p7xtNDbpo",
    open: "false"
  });
</script>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
  // Initialize particles
  function initParticles() {
    if (window.pJSDom && window.pJSDom.length > 0) return;
    particlesJS("particles-js", {
      "particles": {
        "number": { "value": 400, "density": { "enable": true, "value_area": 800 }},
        "color": { "value": "#fff" },
        "shape": {
          "type": "circle",
          "stroke": { "width": 0, "color": "#000" },
          "polygon": { "nb_sides": 5 },
          "image": { "src": "img/github.svg", "width": 100, "height": 100 }
        },
        "opacity": {
          "value": 0.5,
          "random": true,
          "anim": { "enable": false, "speed": 1, "opacity_min": 0.1, "sync": false }
        },
        "size": {
          "value": 10,
          "random": true,
          "anim": { "enable": false, "speed": 40, "size_min": 0.1, "sync": false }
        },
        "line_linked": { "enable": false, "distance": 500, "color": "#ffffff", "opacity": 0.4, "width": 2 },
        "move": {
          "enable": true,
          "speed": 6,
          "direction": "bottom",
          "random": false,
          "straight": false,
          "out_mode": "out",
          "bounce": false,
          "attract": { "enable": false, "rotateX": 600, "rotateY": 1200 }
        }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {
          "onhover": { "enable": false, "mode": "repulse" },
          "onclick": { "enable": false, "mode": "repulse" },
          "resize": true
        },
        "modes": {
          "grab": { "distance": 400, "line_linked": { "opacity": 0.5 } },
          "bubble": { "distance": 400, "size": 4, "duration": 0.3, "opacity": 1, "speed": 3 },
          "repulse": { "distance": 200, "duration": 0.4 },
          "push": { "particles_nb": 4 },
          "remove": { "particles_nb": 2 }
        }
      },
      "retina_detect": true
    });
  }

  // Fetch and populate game links
  async function fetchGameLinks() {
    try {
      const response = await fetch('games.json');
      if (!response.ok) throw new Error('Failed to load');
      const games = await response.json();
      populateGameLinks(games);
    } catch (e) {
      document.getElementById('game-links-grid').innerHTML='<p class="text-white text-center">Error loading game links.</p>';
    }
  }

  function populateGameLinks(games) {
    const grid = document.getElementById('game-links-grid');
    grid.innerHTML = '';
    if (!games || games.length === 0) {
      grid.innerHTML = '<p class="text-white text-center">No game links.</p>';
      return;
    }
    games.forEach((game, index) => {
      const a = document.createElement('a');
      a.href = game.url; a.target = '_blank'; a.rel = 'noopener noreferrer';
      const card = document.createElement('div');
      card.className='frosted-glass rounded-lg overflow-hidden shadow-lg transition-transform duration-300 hover:scale-105';
      const imgSrc = isValidUrl(game.game_image_icon) ? game.game_image_icon : 'https://via.placeholder.com/150';
      card.innerHTML = `<div class="thumbnail-container">
        <img src="${imgSrc}" alt="${game.title}" class="w-full h-48 object-cover no-drag"/>
      </div>
      <div class="p-4">
        <h3 class="text-xl font-bold text-white">${game.title}</h3>
      </div>`;
      a.appendChild(card);
      addTiltEffect(a);
      document.getElementById('game-links-grid').appendChild(a);
    });
  }

  // Fetch embedded games
  async function fetchEmbeddedGames() {
    try {
      const response=await fetch(`embeddedgames.json?t=${Date.now()}`);
      if (!response.ok) throw new Error(`HTTP error!`);
      const games=await response.json();
      populateEmbeddedGames(games);
    } catch (error) {
      document.getElementById('games-grid').innerHTML='<p class="text-white text-center">Error loading embedded games.</p>';
    }
  }

  function populateEmbeddedGames(games) {
    const grid=document.getElementById('games-grid');
    grid.innerHTML='';
    if (!games || games.length===0) {
      grid.innerHTML='<p class="text-white text-center">No embedded games.</p>';
      return;
    }
    games.forEach((game, index) => {
      const iconSize=100;
      const borderRadius=iconSize*0.225;
      const div=document.createElement('div');
      div.className='game-icon';
      div.style.borderRadius=borderRadius+'px';
      div.innerHTML=`<img src="${isValidUrl(game.game_image_icon)?game.game_image_icon:DEFAULT_IMAGE}" alt="${game.title}"/>
        <div class="icon-label">${game.title}</div>`;
      div.addEventListener('click', ()=>showGameOverlay(game.url,`embeddedgame-${index}`,game.title));
      document.getElementById('games-grid').appendChild(div);
    });
  }

  function showGameOverlay(url,iframeId,title) {
    document.querySelector('.game-overlay').innerHTML=`
      <div class="game-overlay-content">
        <button class="close-btn" onclick="hideGameOverlay()">Close</button>
        <div class="iframe-container loading">
          <iframe id="${iframeId}" src="${url}" title="${title}" allowfullscreen></iframe>
          <button class="fullscreen-btn" onclick="attemptFullscreen('${iframeId}')">Fullscreen</button>
          <button class="exit-fullscreen-btn" onclick="exitFullscreen('${iframeId}')">Exit Fullscreen</button>
        </div>
      </div>`;
    document.querySelector('.fullscreen-btn').style.display='block';
    document.querySelector('.exit-fullscreen-btn').style.display='none';
    document.querySelector('.game-overlay').style.display='flex';
  }

  function hideGameOverlay() {
    document.querySelector('.game-overlay').innerHTML='';
    document.querySelector('.game-overlay').style.display='none';
    document.querySelector('.fullscreen-btn').style.display='none';
    document.querySelector('.exit-fullscreen-btn').style.display='none';
  }

  function attemptFullscreen(iframeId) {
    const iframe=document.getElementById(iframeId);
    if (document.fullscreenElement) { document.exitFullscreen(); return; }
    iframe.requestFullscreen().then(()=> {
      document.querySelector('.fullscreen-btn').style.display='none';
      document.querySelector('.exit-fullscreen-btn').style.display='block';
    }).catch(()=>{});
  }

  function exitFullscreen(iframeId) {
    if (document.fullscreenElement){ document.exitFullscreen().then(()=> {
      document.querySelector('.fullscreen-btn').style.display='block';
      document.querySelector('.exit-fullscreen-btn').style.display='none';
    });}
  }

  function isValidUrl(string) {
    try { new URL(string); return true; } catch (_) { return false; }
  }

  function addTiltEffect(element) {
    const handleMouseMove=(e)=>{
      const rect=e.currentTarget.getBoundingClientRect();
      const padding=20;
      const xMin=rect.left-padding; const xMax=rect.right+padding;
      const yMin=rect.top-padding; const yMax=rect.bottom+padding;
      const x=e.clientX; const y=e.clientY;
      const clampedX=Math.min(Math.max(x,xMin),xMax);
      const clampedY=Math.min(Math.max(y,yMin),yMax);
      const centerX=rect.left+rect.width/2;
      const centerY=rect.top+rect.height/2;
      const deltaX=clampedX-centerX;
      const deltaY=clampedY-centerY;
      const maxTilt=20;
      const percentX=deltaX/(rect.width/2);
      const percentY=deltaY/(rect.height/2);
      const rotateY=-maxTilt*percentX;
      const rotateX=maxTilt*percentY;
      e.currentTarget.style.transform=`rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    }
    const handleMouseEnter = (e) => { e.currentTarget.addEventListener('mousemove', handleMouseMove); }
    const handleMouseLeave = (e) => { e.currentTarget.removeEventListener('mousemove', handleMouseMove); e.currentTarget.style.transform='rotateX(0deg) rotateY(0deg)';}
    element.addEventListener('mouseenter', handleMouseEnter);
    element.addEventListener('mouseleave', handleMouseLeave);
  }

  // Fetch and populate forms
  async function fetchForms() {
    try {
      const response=await fetch('forms.json');
      if (!response.ok) throw new Error('Failed to load forms.json');
      const forms=await response.json();
      populateForms(forms);
    } catch(e) {
      document.getElementById('forms-grid').innerHTML='<p class="text-white text-center">Error loading forms</p>';
    }
  }
  function populateForms(forms) {
    const grid=document.getElementById('forms-grid');
    grid.innerHTML='';
    if (!forms || forms.length===0) {
      grid.innerHTML='<p class="text-white text-center">No forms available.</p>';
      return;
    }
    forms.forEach(form => {
      const card=document.createElement('div');
      card.className='form-card';
      card.innerHTML=`<iframe src="${form.url}" class="form-iframe" allowfullscreen></iframe>`;
      grid.appendChild(card);
    });
  }

  // Theme switching with persistence
  function setTheme(theme) {
    document.body.classList.remove('theme-default', 'theme-dark', 'theme-classic');
    if (theme === 'dark') {
      document.body.classList.add('theme-dark');
    } else if (theme === 'classic') {
      document.body.classList.add('theme-classic');
    } else {
      document.body.classList.add('theme-default');
    }
    localStorage.setItem('theme', theme);
    // Update toggle button states
    document.querySelectorAll('.theme-button').forEach(btn => {
      if (btn.dataset.theme === theme || (theme==='default' && !btn.dataset.theme)) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  }

  // Toggle overlay visibility
  document.addEventListener('DOMContentLoaded', () => {
    // Load theme
    const savedTheme = localStorage.getItem('theme') || 'default';
    setTheme(savedTheme);
    // Load custom background if saved
    const savedBg = localStorage.getItem('customBackgroundDataUrl');
    if (savedBg) {
      document.body.style.backgroundImage = `url('${savedBg}')`;
      document.body.style.backgroundRepeat = 'no-repeat';
      document.body.style.backgroundPosition = 'center';
      document.body.style.backgroundAttachment = 'fixed';
      document.body.style.backgroundSize = 'cover'; // ensure full coverage
    }
    fetchEmbeddedGames();
    fetchGameLinks();
    fetchForms();
    initParticles();

    document.getElementById('settings-icon').addEventListener('click', () => {
      document.getElementById('settingsOverlay').classList.toggle('show');
    });
  });

  function closeSettings() {
    document.getElementById('settingsOverlay').classList.remove('show');
  }

  // Custom Background with fixed cover
  let isCustomBgActive = false;

  function toggleCustomBg() {
    isCustomBgActive = !isCustomBgActive;
    document.getElementById('customBgContainer').style.display = isCustomBgActive ? 'block' : 'none';

    if (!isCustomBgActive) {
      // Revert to default
      document.body.style.background = "linear-gradient(to right, var(--bg-gradient-start), var(--bg-gradient-end))";
      document.body.style.backgroundImage = '';
      document.body.style.backgroundRepeat = '';
      document.body.style.backgroundPosition = '';
      document.body.style.backgroundAttachment = '';
      document.body.style.backgroundSize = '';
      localStorage.removeItem('customBackgroundDataUrl');
    }
  }

  function applyUploadedBackground() {
    const fileInput = document.getElementById('backgroundUpload');
    const file = fileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const dataUrl = e.target.result;
        // Set background: cover, fixed
        document.body.style.backgroundImage = `url('${dataUrl}')`;
        document.body.style.backgroundRepeat = 'no-repeat';
        document.body.style.backgroundPosition = 'center';
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundAttachment = 'fixed';
        localStorage.setItem('customBackgroundDataUrl', dataUrl);
        isCustomBgActive = true;
      }
      reader.readAsDataURL(file);
    }
  }

  function applyCustomBackgroundUrl() {
    const url = document.getElementById('bgImageUrl').value.trim();
    if (url && isValidUrl(url)) {
      document.body.style.backgroundImage = `url('${url}')`;
      document.body.style.backgroundRepeat = 'no-repeat';
      document.body.style.backgroundPosition = 'center';
      document.body.style.backgroundSize = 'cover';
      document.body.style.backgroundAttachment = 'fixed';
      localStorage.setItem('customBackgroundDataUrl', url);
      isCustomBgActive = true;
    }
  }

  function removeCustomBackground() {
    document.body.style.background = "linear-gradient(to right, var(--bg-gradient-start), var(--bg-gradient-end))";
    document.body.style.backgroundImage = '';
    document.body.style.backgroundRepeat = '';
    document.body.style.backgroundPosition = '';
    document.body.style.backgroundAttachment = '';
    document.body.style.backgroundSize = '';
    localStorage.removeItem('customBackgroundDataUrl');
    isCustomBgActive = false;
  }

  function isValidUrl(string) {
    try { new URL(string); return true; } catch (_) { return false; }
  }
</script>
</body>
</html>
